<!DOCTYPE html>
<html class="client-nojs" lang="fr" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>Boitier Soekris — OpenWikiBSD</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Boitier_Soekris","wgTitle":"Boitier Soekris","wgCurRevisionId":3394,"wgRevisionId":3394,"wgArticleId":79,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"fr","wgPageContentModel":"wikitext","wgSeparatorTransformTable":[",\t."," \t,"],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],"wgMonthNamesShort":["","jan","fév","mar","avr","mai","juin","juil","août","sep","oct","nov","déc"],"wgRelevantPageName":"Boitier_Soekris","wgRelevantArticleId":79,"wgRequestId":"f42fcd506d8d656c4b76f339","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"loading","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.options@1x2qlv5",function($,jQuery,require,module){mw.user.options.set({"variant":"fr"});});mw.loader.implement("user.tokens@1iezen7",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/;

});mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link rel="stylesheet" href="load.php%3Fdebug=false&amp;lang=fr&amp;modules=mediawiki.legacy.commonPrint%252Cshared%257Cmediawiki.sectionAnchor%257Cmediawiki.skinning.interface%257Cskins.vector.styles&amp;only=styles&amp;skin=vector.css"/>
<script async="" src="load.php%3Fdebug=false&amp;lang=fr&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<meta name="generator" content="MediaWiki 1.29.0"/>
<link rel="shortcut icon" href="http://www.openbsd-edu.net/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="OpenWikiBSD (fr)"/>
<link rel="EditURI" type="application/rsd+xml" href="http://www.openbsd-edu.net/api.php?action=rsd"/>
<link rel="copyright" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"/>
<link rel="alternate" type="application/atom+xml" title="Flux Atom de OpenWikiBSD" href="./index.php%3Ftitle=Sp%25C3%25A9cial:Modifications_r%25C3%25A9centes&amp;feed=atom"/>
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Boitier_Soekris rootpage-Boitier_Soekris skin-vector action-view">		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<div class="mw-indicators mw-body-content">
</div>
			<h1 id="firstHeading" class="firstHeading" lang="fr">Boitier Soekris</h1>
									<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">De OpenWikiBSD</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Aller à :					<a href="index.php%3Ftitle=Boitier_Soekris.html#mw-head">navigation</a>, 					<a href="index.php%3Ftitle=Boitier_Soekris.html#p-search">rechercher</a>
				</div>
				<div id="mw-content-text" lang="fr" dir="ltr" class="mw-content-ltr"><p>24/04/2017&#160;: Soekris ferme boutique&#160;! Trop peu de vente, trop de concurrence.. Snif&#160;!
<a rel="nofollow" class="external autonumber" href="http://soekris.com/">[1]</a>
</p>
<div id="toc" class="toc"><div id="toctitle" class="toctitle"><h2>Sommaire</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="index.php%3Ftitle=Boitier_Soekris.html#Intro"><span class="tocnumber">1</span> <span class="toctext">Intro</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="index.php%3Ftitle=Boitier_Soekris.html#Remarques_sur_le_mat.C3.A9riel"><span class="tocnumber">2</span> <span class="toctext">Remarques sur le matériel</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="index.php%3Ftitle=Boitier_Soekris.html#Boot"><span class="tocnumber">2.1</span> <span class="toctext">Boot</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="index.php%3Ftitle=Boitier_Soekris.html#Principe"><span class="tocnumber">3</span> <span class="toctext">Principe</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="index.php%3Ftitle=Boitier_Soekris.html#Disque_dur"><span class="tocnumber">3.1</span> <span class="toctext">Disque dur</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="index.php%3Ftitle=Boitier_Soekris.html#Compact_Flash"><span class="tocnumber">3.2</span> <span class="toctext">Compact Flash</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="index.php%3Ftitle=Boitier_Soekris.html#Modifications_post_install"><span class="tocnumber">4</span> <span class="toctext">Modifications post install</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="index.php%3Ftitle=Boitier_Soekris.html#Disque_dur_2"><span class="tocnumber">4.1</span> <span class="toctext">Disque dur</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="index.php%3Ftitle=Boitier_Soekris.html#Compact_Flash_2"><span class="tocnumber">4.2</span> <span class="toctext">Compact Flash</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="index.php%3Ftitle=Boitier_Soekris.html#Linux"><span class="tocnumber">4.3</span> <span class="toctext">Linux</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="index.php%3Ftitle=Boitier_Soekris.html#Diff.C3.A9rences_entre_les_mod.C3.A8les_Soekris"><span class="tocnumber">5</span> <span class="toctext">Différences entre les modèles Soekris</span></a></li>
<li class="toclevel-1 tocsection-12"><a href="index.php%3Ftitle=Boitier_Soekris.html#OpenBSD_en_PXE"><span class="tocnumber">6</span> <span class="toctext">OpenBSD en PXE</span></a>
<ul>
<li class="toclevel-2 tocsection-13"><a href="index.php%3Ftitle=Boitier_Soekris.html#M.C3.A9thode_actuelle_.28post_5.5.29"><span class="tocnumber">6.1</span> <span class="toctext">Méthode actuelle (post 5.5)</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="index.php%3Ftitle=Boitier_Soekris.html#Debug"><span class="tocnumber">6.2</span> <span class="toctext">Debug</span></a>
<ul>
<li class="toclevel-3 tocsection-15"><a href="index.php%3Ftitle=Boitier_Soekris.html#.2Fetc.2Frandom.seed_no_such_file_or_directory_:_-.3E_.5B4.5D"><span class="tocnumber">6.2.1</span> <span class="toctext">/etc/random.seed no such file or directory&#160;: -&gt; [4]</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="index.php%3Ftitle=Boitier_Soekris.html#Soekris_bloqu.C3.A9_sur_le_chargment_du_noyau:"><span class="tocnumber">6.2.2</span> <span class="toctext">Soekris bloqué sur le chargment du noyau:</span></a></li>
<li class="toclevel-3 tocsection-17"><a href="index.php%3Ftitle=Boitier_Soekris.html#Bloqu.C3.A9_.C3.A0_entry_point_at_0x200120"><span class="tocnumber">6.2.3</span> <span class="toctext">Bloqué à <i>entry point at 0x200120</i></span></a></li>
<li class="toclevel-3 tocsection-18"><a href="index.php%3Ftitle=Boitier_Soekris.html#open.28_.29_Operation_not_permitted"><span class="tocnumber">6.2.4</span> <span class="toctext">open( ) Operation not permitted</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-19"><a href="index.php%3Ftitle=Boitier_Soekris.html#M.C3.A9thode_obsol.C3.A8te"><span class="tocnumber">6.3</span> <span class="toctext">Méthode obsolète</span></a>
<ul>
<li class="toclevel-3 tocsection-20"><a href="index.php%3Ftitle=Boitier_Soekris.html#Configuration_du_serveur_de_boot"><span class="tocnumber">6.3.1</span> <span class="toctext">Configuration du serveur de boot</span></a>
<ul>
<li class="toclevel-4 tocsection-21"><a href="index.php%3Ftitle=Boitier_Soekris.html#C.C3.B4t.C3.A9_client_PXE"><span class="tocnumber">6.3.1.1</span> <span class="toctext">Côté client PXE</span></a>
<ul>
<li class="toclevel-5 tocsection-22"><a href="index.php%3Ftitle=Boitier_Soekris.html#Clavier_inutilisable_sous_Minicom"><span class="tocnumber">6.3.1.1.1</span> <span class="toctext">Clavier inutilisable sous Minicom</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-23"><a href="index.php%3Ftitle=Boitier_Soekris.html#WatchDog"><span class="tocnumber">7</span> <span class="toctext">WatchDog</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Intro">Intro</span></h2>
<p>Il existe un certain nombre de méthodes d'installation tant de linux que d'OpenBSD sur ces boitiers. Google est votre ami.
</p><p>J'ai tenté un système plus basique qui, moyennant quelques précautions est assez pratique et ne demande pas de disposer d'un serveur dhcp pxe avec image de boot. (Il faut juste VMWare pour une CF et un portable ancien (port IDE) pour un disque, quand même..)
</p><p><b>MaJ</b>&#160;: La méthode PXE/DHCP/TFTP est quand même plus simple...
</p>
<h2><span class="mw-headline" id="Remarques_sur_le_mat.C3.A9riel">Remarques sur le matériel</span></h2>
<ul><li> Les <a rel="nofollow" class="external text" href="http://soekris.com/downloads.html">specs</a></li>
<li> La conso électrique est TRES réduite (moins de 10W)</li>
<li> Pas de clavier, pas de souris, pas d'écran...</li>
<li> Boot sur un disque IDE 2'1/2
<ul><li> Le disque est vu en hda (Linux) ou wd0 (OpenBSD)</li></ul></li>
<li> boot sur carte CF
<ul><li> La CF est vue en hdb (Linux) ou wd1 (OpenBSD)</li></ul></li></ul>
<h3><span class="mw-headline" id="Boot">Boot</span></h3>
<p>Depuis la version [ <a rel="nofollow" class="external free" href="http://soekris.com/media/software/changelog.txt">http://soekris.com/media/software/changelog.txt</a>  1.41] du comBIOS, il est possible de démarrer sur de l'USB, CDROM par exemple.
En revanche, il faut que votre lecteur USB soit alimenté, car le port USB exterieur ne débite pas forcément beaucoup..
Attention, ceci ne concerne pas les 4801 qui ne pourront jamais booter sur de l'USB en flash.
</p><p><a rel="nofollow" class="external text" href="http://www.wiki.soekris.info/What_do_all_those_BIOS_settings_do%3F">Réglages BIOS</a>
</p>
<h2><span class="mw-headline" id="Principe">Principe</span></h2>
<h3><span class="mw-headline" id="Disque_dur">Disque dur</span></h3>
<ul><li> On insère le disque 2'1/2 dans un portable et on fait une install classique</li>
<li> On effectue les modifs nécessaires <a href="index.php%3Ftitle=Boitier_Soekris.html#Disque_dur" title="Boitier Soekris"> ici</a></li></ul>
<h3><span class="mw-headline" id="Compact_Flash">Compact Flash</span></h3>
<ul><li> On utilise un adaptateur CF-USB et on fait une install dans VMWare en faisant reconnaitre la CF comme un disque IDE</li></ul>
<p>Sous un hôte Linux, j'ai eu un souci de mise en place de cette méthode. Impossible d'accéder au raw device:<i>Insufficient permission to access file</i>
</p><p>Solution:
</p><p><b>En root</b>
sudo vmware
</p>
<ol><li> Add Hardware Wizard</li>
<li> Hard disk</li>
<li> Use Physical disk</li>
<li> Device&#160;: /dev/sd<b>X</b>&#160;: Attention à ne pas vous planter là-dessus, <i>dmesg</i> sur l'hôte est votre ami.</li>
<li> Use entire disk</li>
<li> Valider</li></ol>
<ol><li> Faites l'install su la CF (vue comme un disque IDE sous VMware)</li></ol>
<ol><li> Fermez VMware</li></ol>
<ol><li> Sortez et réinsérez la CF.</li></ol>
<ol><li> elle est vue comme un FS linux classique. Faites les modifs, maintenant.</li></ol>
<p><br />
</p>
<ul><li> Ou on utilise un adaptateur CF-IDE et on revient au cas précédent (Disque IDE 1'1/2). <i>Méthode non testée</i></li></ul>
<h2><span class="mw-headline" id="Modifications_post_install">Modifications post install</span></h2>
<h3><span class="mw-headline" id="Disque_dur_2">Disque dur</span></h3>
<h3><span class="mw-headline" id="Compact_Flash_2">Compact Flash</span></h3>
<ul><li> Après la fin de l'install dans VMWare, il faut effectuer les modifs suivantes&#160;:</li></ul>
<h3><span class="mw-headline" id="Linux">Linux</span></h3>
<ul><li><ul><li> <b>/etc/inittab</b></li></ul></li></ul>
<pre>
#Au lieu de 
1:2345:respawn:/sbin/getty 38400 tty1

#Mettre

1:2345:respawn:/sbin/getty  -L 19200 ttyS0 ansi

</pre>
<ul><li><ul><li> <b>/boot/grub/menu.lst</b></li></ul></li></ul>
<pre>

 ## ## End Default Options ##

#Ajouter&#160;:
default 0
timeout 5
serial --unit=0 sspeed=19200 --word=8 --parity=no --stop=1
terminal --timeout=0 serial

title          Debian GNU/Linux, kernel 2.6.26-1-686-Soekris
root           (hd0,0)
kernel         /boot/vmlinuz-2.6.26-1-686 root=/dev/hdb1 ro  console=tty0 console=ttyS0,19200n8 acpi=off
initrd         /boot/initrd.img-2.6.26-1-686
savedefault
boot
 
</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="Diff.C3.A9rences_entre_les_mod.C3.A8les_Soekris">Différences entre les modèles Soekris</span></h2>
<ul><li> Les cartes réseaux sont en sisX (Realtek) pour les modèles 4801</li>
<li> Les cartes réseaux sont en emX  (Intel) pour les modèles 6501</li>
<li> Tous les Soekris sont à utiliser préférentiellement en i386. Il n'est pas impossible que l'architecture amd64 fonctionne sur les 6501; sans forcément de gain notable néanmoins.: <a rel="nofollow" class="external autonumber" href="http://lists.soekris.com/pipermail/soekris-tech/2013-May/018966.html">[2]</a></li></ul>
<h2><span class="mw-headline" id="OpenBSD_en_PXE">OpenBSD en PXE</span></h2>
<h3><span class="mw-headline" id="M.C3.A9thode_actuelle_.28post_5.5.29">Méthode actuelle (post 5.5)</span></h3>
<p>Désormais la config se fait une fois sur le serveur OpenBSD (plutôt) et l'install se fait automatiquement en PXE sur le client.
</p><p>Quasiment tout vient d'ici&#160;: <a rel="nofollow" class="external autonumber" href="http://www.bsdnow.tv/tutorials/autoinstall">[3]</a>, mais pas complétement.
</p>
<ul><li> Trouver l'adresse MAC du boitier Soekris</li></ul>
<p>Enlever la carte CF et booter en PXE sur le port eth0
</p><p>Les logs du serveur dhcp vous donneront l'info.
</p>
<pre>pkg_add -v wget
</pre>
<ul><li> Modifier <i>/etc/dhcpd.conf</i> et ajouter</li></ul>
<pre> filename "auto_install";
 next-server 10.0.0.1;
</pre>
<p>voire
</p>
<pre>host soekris {
hardware ethernet 00:00:XX:YY:ZZ:XX;
fixed-address 10.0.10.1;
option subnet-mask 255.255.0.0;
filename "pxeboot";
}
</pre>
<pre> /etc/rc.d/dhcpd restart
 mkdir -p /tftp/etc
 cd /tftp/
 wget <a rel="nofollow" class="external free" href="http://mirrors.ircam.fr/pub/OpenBSD/6.1/i386/pxeboot">http://mirrors.ircam.fr/pub/OpenBSD/6.1/i386/pxeboot</a>
 wget <a rel="nofollow" class="external free" href="http://mirrors.ircam.fr/pub/OpenBSD/6.1/i386/bsd.rd">http://mirrors.ircam.fr/pub/OpenBSD/6.1/i386/bsd.rd</a>
 ln -s pxeboot auto_install
 mv bsd.rd bsd
</pre>
<pre> echo "
  stty com0 19200
  boot bsd
  " &gt; /tftp/etc/boot.conf 
</pre>
<pre> echo 'tftpd_flags="-4 /tftp"' &gt;&gt; /etc/rc.conf.local
 /etc/rc.d/tftpd start
 cd /var/www/htdocs/
  wget -nH -r <a rel="nofollow" class="external free" href="http://ftp2.fr.openbsd.org/pub/OpenBSD/6.1/i386/{BUILDINFO,SHA256,SHA256.sig,INSTALL.i386,base61.tgz,bsd,bsd.rd,bsd.mp,comp61.tgz,man61.tgz,xbase61.tgz,xfont61.tgz,xserver61.tgz,xshare61.tgz}">http://ftp2.fr.openbsd.org/pub/OpenBSD/6.1/i386/{BUILDINFO,SHA256,SHA256.sig,INSTALL.i386,base61.tgz,bsd,bsd.rd,bsd.mp,comp61.tgz,man61.tgz,xbase61.tgz,xfont61.tgz,xserver61.tgz,xshare61.tgz}</a>
</pre>
<pre> echo 'nginx_flags=""' &gt;&gt; /etc/rc.conf.local
 /etc/rc.d/nginx start
</pre>
<p>Ajouter 
</p>
<pre>autoindex on;
</pre>
<p>à /etc/nginx/nginx.conf
</p>
<pre>/etc/rc.d/nginx restart 
</pre>
<p>La <a rel="nofollow" class="external text" href="http://www.openbsd.org/cgi-bin/man.cgi/OpenBSD-current/man8/autoinstall.8?query=autoinstall&amp;sec=8">| doc</a>
</p>
<pre>touch  /var/www/htdocs/@MAC-install.conf
</pre>
<pre> echo "System hostname =  FQDN-SRV
Password for root = PASS
Network interfaces = vi0
IPv4 address for em0 = dhcp
Setup a user = USER
Password for user = PASS
Public ssh key for user = ssh-ed25519 AAAAC3NzaC1...g3Aqre puffy@ai 
What timezone are you in = Europe/Paris
Location of sets = http
Server = 10.0.0.1
" &gt; /var/www/htdocs/install.conf
</pre>
<p>Ce qui permet d'avoir une config par client PXE.
</p>
<pre>touch /var/www/htdocs/pub/OpenBSD/5.6/i386/install.site
</pre>
<pre>echo "
#!/bin/sh
set -x
export PKG_PATH=<a rel="nofollow" class="external free" href="ftp://ftp.fr.openbsd.org/pub/OpenBSD/`uname">ftp://ftp.fr.openbsd.org/pub/OpenBSD/`uname</a> -r`/packages/`uname -m`
pkg_add -r bash wget zip vim--no_x11 rsync-- munin-node
" &gt;   /var/www/htdocs/pub/OpenBSD/5.6/i386/install.site
</pre>
<p>Rien à faire, et en plus les packages s'installent&#160;!
</p><p>Pour le moment, on ne peut pas choisir l'état du disque dur en terme de répartition des partitions.
</p><p>Attention à bien remettre le boot par défaut sur la CF sinon, vous allez boucler sur une réinstallation..
</p>
<h3><span class="mw-headline" id="Debug">Debug</span></h3>
<ul><li> <a href="index.php%3Ftitle=Boitier_Soekris.html#C.C3.B4t.C3.A9_client_PXE" title="Boitier Soekris">un câble série et votre Soekris vous dira ce qui le chagrine..</a> </li></ul>
<h4><span class="mw-headline" id=".2Fetc.2Frandom.seed_no_such_file_or_directory_:_-.3E_.5B4.5D">/etc/random.seed no such file or directory&#160;: -&gt; <a rel="nofollow" class="external autonumber" href="http://comments.gmane.org/gmane.os.openbsd.misc/215090">[4]</a></span></h4>
<pre>mkdir -p /tftp/etc
mkfifo /tftp/etc/random.seed
while true; do dd if=/dev/random count=1 &gt; /tftp/etc/random.seed 2&gt;/dev/null; done &amp;
</pre>
<h4><span class="mw-headline" id="Soekris_bloqu.C3.A9_sur_le_chargment_du_noyau:">Soekris bloqué sur le chargment du noyau:</span></h4>
<pre>&gt;&gt; OpenBSD/amd64 PXEBOOT 3.23
</pre>
<p>La réponse est simple, non...c'est du i386, benêt&#160;;-)
</p><p><br />
</p>
<h4><span class="mw-headline" id="Bloqu.C3.A9_.C3.A0_entry_point_at_0x200120">Bloqué à <i>entry point at 0x200120</i></span></h4>
<p>Plusieurs possibilités&#160;:
</p>
<ul><li><ul><li> Vous avez fait une install en VM et modifié le nom du périphérique.<a rel="nofollow" class="external autonumber" href="http://hihn.org/2013/05/openbsd-entry-point-at-0x200120/">[5]</a></li>
<li> Vous avez fait une boulette dans la config du serveur tftp</li></ul></li></ul>
<h4><span class="mw-headline" id="open.28_.29_Operation_not_permitted">open( ) Operation not permitted</span></h4>
<pre>open(tftp:/etc/boot.conf): Operation not permitted
boot&gt;
</pre>
<p>N'oubliez pas de mettre le "-s" dans le serveur tftp afin de rendre l'appel au fichier relatif et non absolu.
</p>
<h3><span class="mw-headline" id="M.C3.A9thode_obsol.C3.A8te">Méthode obsolète</span></h3>
<h4><span class="mw-headline" id="Configuration_du_serveur_de_boot">Configuration du serveur de boot</span></h4>
<p><a rel="nofollow" class="external text" href="http://lists.soekris.com/pipermail/soekris-tech/2004-February/005119.html">Lien d'origine</a>
avec <a rel="nofollow" class="external text" href="http://onlamp.com/pub/a/bsd/2004/04/29/Big_Scary_Daemons.html">une modif</a>
</p><p>On va partir sur l'installation sur une CF (2Go).
Il faut&#160;: 
</p>
<ol><li> Un serveur de boot PXE  (Debian/Squeeze):</li></ol>
<pre>apt-get install dhcp3-server tftpd rarpd openbsd-inetd
</pre>
<p>Modifs dans /etc/dhcp/dhcpd.conf
</p>
<pre>
option domain-name "schwarz-fr.net";
option domain-name-servers @IP;
default-lease-time 600;
max-lease-time 7200;
authoritative;
log-facility local7;
subnet @LAN netmask 255.255.255.0 {
  range @IP1 @IP2;
  option routers @IP;
}

host soekris {
  hardware ethernet @MAC;
  fixed-address @IP;
  option host-name "soekris";
  next-server @IP;
  filename "pxegrub.sis";
}
</pre>
<pre>

echo "tftp            dgram   udp     wait    nobody  /usr/sbin/tcpd  /usr/sbin/in.tftpd -s /srv/tftp/"
&gt;&gt; /etc/inetd.conf
</pre>
<pre>mkdir /srv/tftp
wget 	<a rel="nofollow" class="external free" href="http://www.berger.to/openbsd/pxegrub.sis-tty-19200.gz">http://www.berger.to/openbsd/pxegrub.sis-tty-19200.gz</a>
gzip -d pxegrub.sis-tty-19200.gz
mv pxegrub.sis-tty-1920O /srv/tftp/pxegrub.sis
wget <a rel="nofollow" class="external free" href="http://ftp.fr.openbsd.org/pub/OpenBSD/4.9/i386/bsd.rd">http://ftp.fr.openbsd.org/pub/OpenBSD/4.9/i386/bsd.rd</a>
mv bsd.rd /srv/tftp/
echo "@MACSOekris  @IPSoekris" &gt;&gt; /etc/ethers
</pre>
<p><br />
</p>
<pre>
echo "default=0
timeout=5
serial --unit=0 --speed=19200
terminal serial
title soekris
kernel //bsd.rd
root (nd)
boot
" &gt; /srv/tftp/grub.conf

/etc/init.d/openbsd-inetd restart
/etc/init.d/isc-dhcp-server restart

</pre>
<h5><span class="mw-headline" id="C.C3.B4t.C3.A9_client_PXE">Côté client PXE</span></h5>
<ol><li> Un cable série (F) - Série (F)</li>
<li> un emulateur de terminal (minicom est parfait)</li></ol>
<p>On  se connecte au port série&#160;:
<i>minicom  -s</i> qui va configurer le bon port série (/dev/tty0 chez moi et pas /dev/tty1, je n'ai qu'un seul port série sur le portable)
<a rel="nofollow" class="external text" href="http://www.dblab.ece.ntua.gr/~adamo/howto/OpenBSD/OpenBSD-3.9_Soekris-4801.html%7C">Un lien</a>
</p>
<pre>sudo minicom -s
</pre>
<p>Port série /dev/ttyS0
</p><p>Paramètres 19200 8N1
</p><p>(<i> CTRL+A Z     P         A       Entrée</i>)
</p><p>Si la version de minicom ne propose pas 19200, sortez de minicom et éditez /etc/minicom/minirc.dfl
</p>
<ul><li> Les paramètres de boot sont&#160;:
<ul><li> 81&#160;: disque dur</li>
<li> 80&#160;: CF</li>
<li> F0&#160;: PXE</li></ul></li></ul>
<ul><li> <b>Attention</b>, seul le port <i>eth0</i> permet le boot PXE!</li></ul>
<ul><li> Activez le boot PXE</li></ul>
<pre>CTRL+P
boot F0
</pre>
<p>Puis vous faites l'install normale de l'OS.
</p><p>Si au boot, vous rencontrez 
</p>
<pre>Invalid system disk
Replace the disk, and then press any key
</pre>
<p>On reboot , puis Ctrl-P
</p>
<pre> set BootDrive=81 80 F0 FF
reboot
</pre>
<p>Au reboot, toujours connecté en port série, il faut activer le reboot par défaut sur la CF:
</p>
<pre>set BootDrive=80 F0
</pre>
<pre>reboot
</pre>
<p>et c'est parti.
</p>
<h6><span class="mw-headline" id="Clavier_inutilisable_sous_Minicom">Clavier inutilisable sous Minicom</span></h6>
<p>Désactivez le contrôle de flux matériel
</p>
<h2><span class="mw-headline" id="WatchDog">WatchDog</span></h2>
<p>Le boîtier Soekris dispose d'un watchdog matériel. Ce dispositif permet de redémarrer matériellement et sans être OS-dépendant le boitier.
Pour cela, un démon qui tourne sur l'OS vient remettre à zéro un timer à intervalle de temps régulier.
Quand ce timer matériel arrive en bout de course ( 30s par défaut), il considère l'OS comme figé et redémarre brutalement la machine.
Côté OS, le démon vient (tous les TTL/3, soit 10s par défaut) se rappeler aux bons souvenirs du matériel.
</p><p>La réalisation est simplissime&#160;:
</p>
<ul><li> Vérifier les timers:</li></ul>
<pre>sysctl -a |grep watchdog
kern.watchdog.period=30
kern.watchdog.auto=0
</pre>
<ul><li> Lancer la partie OS</li></ul>
<pre>/usr/sbin/watchdogd
</pre>
<p>A ajouter au /etc/rc.conf.local pour action au redémarrage
</p>
<ul><li> Tester:</li></ul>
<pre>kill -9 `ps ax |grep watchdogd |cut -d" " -f1`
</pre>
<!-- 
NewPP limit report
Cached time: 20171020132852
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.200 seconds
Real time usage: 0.202 seconds
Preprocessor visited node count: 136/1000000
Preprocessor generated node count: 196/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->

<!-- Saved in parser cache with key WikiBSD:pcache:idhash:79-0!*!0!!fr!*!* and timestamp 20171020132851 and revision id 3394
 -->
</div>					<div class="printfooter">
						Récupérée de «&#160;<a dir="ltr" href="http://www.openbsd-edu.net/index.php?title=Boitier_Soekris&amp;oldid=3394">http://www.openbsd-edu.net/index.php?title=Boitier_Soekris&amp;oldid=3394</a>&#160;»					</div>
				<div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div>				<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Menu de navigation</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Outils personnels</h3>
						<ul>
							<li id="pt-login"><a href="./index.php%3Ftitle=Sp%25C3%25A9cial:Connexion&amp;returnto=Boitier+Soekris.html" title="Il est recommandé de vous identifier ; ce n'est cependant pas obligatoire. [o]" accesskey="o">Se connecter</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Espaces de noms</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="index.php%3Ftitle=Boitier_Soekris.html"  title="Voir la page de contenu [c]" accesskey="c">Page</a></span></li>
															<li  id="ca-talk" class="new"><span><a href="http://www.openbsd-edu.net/index.php?title=Discussion:Boitier_Soekris&amp;action=edit&amp;redlink=1"  title="Discussion au sujet de cette page de contenu [t]" accesskey="t" rel="discussion">Discussion</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label">
							<span>Variantes</span><a href="index.php%3Ftitle=Boitier_Soekris.html#"></a>
						</h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Affichages</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="index.php%3Ftitle=Boitier_Soekris.html" >Lire</a></span></li>
															<li id="ca-viewsource"><span><a href="http://www.openbsd-edu.net/index.php?title=Boitier_Soekris&amp;action=edit"  title="Cette page est protégée.&#10;Vous pouvez toutefois en visualiser la source. [e]" accesskey="e">Voir le texte source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="http://www.openbsd-edu.net/index.php?title=Boitier_Soekris&amp;action=history"  title="Les versions passées de cette page (avec leurs contributeurs) [h]" accesskey="h">Historique</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>Plus</span><a href="index.php%3Ftitle=Boitier_Soekris.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Rechercher</label>
						</h3>

						<form action="http://www.openbsd-edu.net/index.php" id="searchform">
							<div id="simpleSearch">
							<input type="search" name="search" placeholder="Rechercher sur OpenWikiBSD" title="Rechercher dans OpenWikiBSD [f]" accesskey="f" id="searchInput"/><input type="hidden" value="Spécial:Recherche" name="title"/><input type="submit" name="fulltext" value="Rechercher" title="Rechercher les pages comportant ce texte." id="mw-searchButton" class="searchButton mw-fallbackSearchButton"/><input type="submit" name="go" value="Lire" title="Aller vers une page portant exactement ce nom si elle existe." id="searchButton" class="searchButton"/>							</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="index.php%3Ftitle=Accueil.html"  title="Page principale"></a></div>
						<div class="portal" role="navigation" id='p-navigation' aria-labelledby='p-navigation-label'>
			<h3 id='p-navigation-label'>Navigation</h3>

			<div class="body">
									<ul>
						<li id="n-mainpage-description"><a href="index.php%3Ftitle=Accueil.html" title="Aller à l'accueil [z]" accesskey="z">Accueil</a></li><li id="n-recentchanges"><a href="./index.php%3Ftitle=Sp%25C3%25A9cial:Modifications_r%25C3%25A9centes.html" title="Liste des modifications récentes sur le wiki [r]" accesskey="r">Modifications récentes</a></li><li id="n-randompage"><a href="./index.php%3Ftitle=Sp%25C3%25A9cial:Page_au_hasard.html" title="Afficher une page au hasard [x]" accesskey="x">Page au hasard</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="Aide">Aide</a></li>					</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Outils</h3>

			<div class="body">
									<ul>
						<li id="t-whatlinkshere"><a href="./index.php%3Ftitle=Sp%25C3%25A9cial:Pages_li%25C3%25A9es%252FBoitier_Soekris.html" title="Liste des pages liées qui pointent sur celle-ci [j]" accesskey="j">Pages liées</a></li><li id="t-recentchangeslinked"><a href="http://www.openbsd-edu.net/index.php?title=Sp%C3%A9cial:Suivi_des_liens/Boitier_Soekris" rel="nofollow" title="Liste des modifications récentes des pages appelées par celle-ci [k]" accesskey="k">Suivi des pages liées</a></li><li id="t-specialpages"><a href="./index.php%3Ftitle=Sp%25C3%25A9cial:Pages_sp%25C3%25A9ciales.html" title="Liste de toutes les pages spéciales [q]" accesskey="q">Pages spéciales</a></li><li id="t-print"><a href="http://www.openbsd-edu.net/index.php?title=Boitier_Soekris&amp;printable=yes" rel="alternate" title="Version imprimable de cette page [p]" accesskey="p">Version imprimable</a></li><li id="t-permalink"><a href="http://www.openbsd-edu.net/index.php?title=Boitier_Soekris&amp;oldid=3394" title="Adresse permanente de cette version de la page">Adresse permanente</a></li><li id="t-info"><a href="http://www.openbsd-edu.net/index.php?title=Boitier_Soekris&amp;action=info" title="Plus d’information sur cette page">Information sur la page</a></li>					</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> Cette page a été modifiée pour la dernière fois le 21 mai 2017 à 13:44.</li>
											<li id="footer-info-copyright">Le contenu est disponible sous licence <a class="external" rel="nofollow" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons paternité – non commercial – partage à l’identique</a> sauf mention contraire.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="http://www.openbsd-edu.net/index.php?title=OpenWikiBSD:Confidentialit%C3%A9" title="OpenWikiBSD:Confidentialité">Politique de confidentialité</a></li>
											<li id="footer-places-about"><a href="http://www.openbsd-edu.net/index.php?title=OpenWikiBSD:%C3%80_propos" title="OpenWikiBSD:À propos">À propos de OpenWikiBSD</a></li>
											<li id="footer-places-disclaimer"><a href="http://www.openbsd-edu.net/index.php?title=OpenWikiBSD:Avertissements_g%C3%A9n%C3%A9raux" title="OpenWikiBSD:Avertissements généraux">Avertissements</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
							<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="resources/assets/licenses/cc-by-nc-sa.png" alt="Creative Commons paternité – non commercial – partage à l’identique" width="88" height="31"/></a>						</li>
											<li id="footer-poweredbyico">
							<a href="http://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>						</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.200","walltime":"0.202","ppvisitednodes":{"value":136,"limit":1000000},"ppgeneratednodes":{"value":196,"limit":1000000},"postexpandincludesize":{"value":0,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"timingprofile":["100.00%    0.000      1 -total"]},"cachereport":{"timestamp":"20171020132852","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":1664});});</script>
	</body>
</html>
